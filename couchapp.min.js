var __slice=Array.prototype.slice;define("events",[],function(){var a;return a={bind:function(a,b){var c,d,e,f,g;d=a.split(" "),c=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={});for(f=0,g=d.length;f<g;f++)e=d[f],c[e]||(c[e]=[]),c[e].push(b);return this},one:function(a,b){return this.bind(a,function(){return this.unbind(a,arguments.callee),b.apply(this,arguments)})},trigger:function(){var a,b,c,d,e,f,g;a=1<=arguments.length?__slice.call(arguments,0):[],c=a.shift(),d=this.hasOwnProperty("_callbacks")&&((g=this._callbacks)!=null?g[c]:void 0);if(!d)return;for(e=0,f=d.length;e<f;e++){b=d[e];if(b.apply(this,a)===!1)break}return!0},unbind:function(a,b){var c,d,e,f,g;if(!a)return this._callbacks={},this;e=(g=this._callbacks)!=null?g[a]:void 0;if(!e)return this;if(!b)return delete this._callbacks[a],this;for(d=0,f=e.length;d<f;d++){c=e[d];if(c!==b)continue;e=e.slice(),e.splice(d,1),this._callbacks[a]=e;break}return this}},a}),define("errors",[],function(){var a;return a={INVALID_KEY:function(a){var b;return b=a.id?"id":"type",new Error("invalid "+b+" '"+a[b]+"': numbers and lowercase letters allowed only")},INVALID_ARGUMENTS:function(a){return new Error(a)},NOT_FOUND:function(a,b){return new Error(""+a+" with "+b+" could not be found")}}});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("store",["events","errors"],function(a,b){var c;return c=function(a){function d(){this.is_persistent()||(this._getItem=function(){return null},this._setItem=function(){return null},this._removeItem=function(){return null},this._key=function(){return null},this._length=function(){return 0},this._clear=function(){return null})}var c;return __extends(d,a),d.prototype.save=function(a,c,d){var e;e=this._deferred();switch(arguments.length){case 2:d=c,c=d.id;break;case 1:d=a,a=d.type,c=d.id}if(typeof d!="object")return e.reject(b.INVALID_ARGUMENTS("object is "+typeof d)),e;c||(c=this.uuid());if(!this._is_valid_key(c))return e.reject(b.INVALID_KEY({id:c})),e;if(!this._is_valid_key(a))return e.reject(b.INVALID_KEY({type:a})),e;d.created_at||(d.created_at=d.updated_at=this._now()),delete d.id,delete d.type;try{d=this.cache(a,c,d),e.resolve(d)}catch(f){e.reject(f)}return e},d.prototype.create=d.prototype.save,d.prototype.update=d.prototype.save,d.prototype.load=function(a,c){var d,e,f;e=this._deferred();if(arguments.length=typeof a=="object")f=[a.type,a.id],a=f[0],c=f[1];if(typeof a!="string"||typeof c!="string")return e.reject(b.INVALID_ARGUMENTS("type & id are required"));try{d=this.cache(a,c);if(!d)return e.reject(b.NOT_FOUND(a,c)),e;e.resolve(d)}catch(g){e.reject(g)}return e},d.prototype.get=d.prototype.load,d.prototype.loadAll=function(a){var b,c,d,e,f,g;e=this._deferred(),d=this._index();try{f=function(){var e,f,h,i;i=[];for(e=0,f=d.length;e<f;e++){c=d[e];if(a!==void 0&&c.indexOf(a)!==0||!this._is_semantic_id(c))continue;h=c.split("/"),g=h[0],b=h[1],i.push(this.cache(g,b))}return i}.call(this),e.resolve(f)}catch(h){e.reject(h)}return e},d.prototype.getAll=d.prototype.loadAll,d.prototype.destroy=function(a,c){var d,e,f;return f=this._deferred(),e=this.cache(a,c),e?(e._rev?(e._deleted=!0,this.cache(a,c,e)):(d=""+a+"/"+c,this._removeItem(d),delete this._cached[d],this.clear_changed(a,c)),f.resolve(e)):f.reject(b.NOT_FOUND(a,c))},d.prototype["delete"]=d.prototype.destroy,d.prototype.cache=function(a,b,c,d){var e,f;c==null&&(c=!1),d==null&&(d={}),f=""+a+"/"+b;if(c){this._cached[f]=c,delete c.type,delete c.id,this._setItem(f,JSON.stringify(c));if(d.remote)return this.clear_changed(a,b),c}else{if(this._cached[f]!=null)return this._cached[f];e=this._getItem(f),e?this._cached[f]=JSON.parse(e):this._cached[f]=!1}return this.is_dirty(a,b)||this.is_marked_as_deleted(a,b)?this.changed(a,b,this._cached[f]):this.clear_changed(a,b),this._cached[f].type=a,this._cached[f].id=b,this._cached[f]},d.prototype.clear_changed=function(a,b){var c;return c=""+a+"/"+b,c?delete this._dirty[c]:this._dirty={}},d.prototype.is_marked_as_deleted=function(a,b){return this.cache(a,b)._deleted===!0},d.prototype.changed=function(a,b,c){var d,e=this;return d=""+a+"/"+b,c?(this._dirty[d]=c,this.trigger("dirty_change"),window.clearTimeout(this._dirty_timeout),this._dirty_timeout=window.setTimeout(function(){return e.trigger("dirty_idle")},2e3)):arguments.length?this._dirty[d]:this._dirty},c=null,d.prototype.is_dirty=function(a,b){var c;return a==null&&(a=null),b==null&&(b=null),a?(c=""+a+"/"+b,this.cache(a,b).synced_at?this.cache(a,b).updated_at?(this.cache(a,b).synced_at instanceof Date||(this.cache(a,b).synced_at=Date.parse(this.cache(a,b).synced_at)),this.cache(a,b).updated_at instanceof Date||(this.cache(a,b).updated_at=Date.parse(this.cache(a,b).updated_at)),this.cache(a,b).synced_at.getTime()<this.cache(a,b).updated_at.getTime()):!1:!0):_(this._dirty).keys().length>0},d.prototype.clear=function(){var a;a=this._deferred();try{this._clear(),this._cached={},this.clear_changed(),a.resolve()}catch(b){a.reject()}return a},d.prototype.is_persistent=function(){try{if(!window.localStorage)return!1;localStorage.setItem("Storage-Test","1");if(localStorage.getItem("Storage-Test")!=="1")return!1;localStorage.removeItem("Storage-Test")}catch(a){return!1}return!0},d.prototype.uuid=function(a){var b,c,d;return a==null&&(a=7),b="0123456789abcdefghijklmnopqrstuvwxyz".split(""),d=b.length,function(){var e;e=[];for(c=0;0<=a?c<a:c>a;0<=a?c++:c--)e.push(b[0|Math.random()*d]);return e}().join("")},d.prototype._getItem=function(a){return window.localStorage.getItem(a)},d.prototype._setItem=function(a,b){return window.localStorage.setItem(a,b)},d.prototype._removeItem=function(a){return window.localStorage.removeItem(a)},d.prototype._key=function(a){return window.localStorage.key(a)},d.prototype._length=function(){return window.localStorage.length},d.prototype._clear=function(){return window.localStorage.clear()},d.prototype._now=function(){return new Date},d.prototype._is_valid_key=function(a){return/^[a-z0-9]+$/.test(a)},d.prototype._is_semantic_id=function(a){return/^[a-z0-9]+\/[a-z0-9]+$/.test(a)},d.prototype._deferred=$.Deferred,d.prototype._cached={},d.prototype._dirty={},d.prototype._index=function(){var a,b,c;c=[];for(a=0,b=this._length();0<=b?a<b:a>b;0<=b?a++:a--)c.push(this._key(a));return c},d}(a)});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("couchapp",["events","store"],function(a,b){var c;return c=function(a){function c(a){this.couchDB_url=a,this.couchDB_url=this.couchDB_url.replace(/\/+$/,""),this.store=new b(this)}return __extends(c,a),c.prototype.sign_up=function(a,b){var c,d,e,f,g;return e="org.couchdb.user",c=""+e+":"+a,f=hex_sha1(this.store.uuid()),d=hex_sha1(b+f),g={_id:c,name:a,type:"user",roles:[],salt:f,password_sha:d},$.ajax({type:"PUT",url:""+this.couchDB_url+"/_users/"+encodeURIComponent(c),data:JSON.stringify(g),contentType:"application/json"})},c.prototype.sign_in=function(a,b){var c;return c=JSON.stringify({name:a,password:b}),$.ajax({type:"POST",url:""+this.couchDB_url+"/_session",data:c,contentType:"application/json"})},c.prototype.login=c.prototype.sign_in,c.prototype.change_password=function(a){return alert("change password is not yet implementd")},c.prototype.sign_out=function(){return $.ajax({type:"DELETE",url:""+this.couchDB_url+"/_session",contentType:"application/json"})},c.prototype.logout=c.prototype.sign_out,c}(a)})