var __slice=Array.prototype.slice;define("events",[],function(){var a;return a=function(){function a(){}return a.prototype.bind=function(a,b){var c,d,e,f,g,h;d=a.split(" "),c=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={}),h=[];for(f=0,g=d.length;f<g;f++)e=d[f],c[e]||(c[e]=[]),h.push(c[e].push(b));return h},a.prototype.on=a.prototype.bind,a.prototype.one=function(a,b){return this.bind(a,function(){return this.unbind(a,arguments.callee),b.apply(this,arguments)})},a.prototype.trigger=function(){var a,b,c,d,e,f,g;a=1<=arguments.length?__slice.call(arguments,0):[],c=a.shift(),d=this.hasOwnProperty("_callbacks")&&((g=this._callbacks)!=null?g[c]:void 0);if(!d)return;for(e=0,f=d.length;e<f;e++){b=d[e];if(b.apply(this,a)===!1)break}return!0},a.prototype.unbind=function(a,b){var c,d,e,f,g;if(!a)return this._callbacks={},this;e=(g=this._callbacks)!=null?g[a]:void 0;if(!e)return this;if(!b)return delete this._callbacks[a],this;for(d=0,f=e.length;d<f;d++){c=e[d];if(c!==b)continue;e=e.slice(),e.splice(d,1),this._callbacks[a]=e;break}return this},a}()}),define("errors",[],function(){var a;return a={INVALID_KEY:function(a){var b;return b=a.id?"id":"type",new Error("invalid "+b+" '"+a[b]+"': numbers and lowercase letters allowed only")},INVALID_ARGUMENTS:function(a){return new Error(a)},NOT_FOUND:function(a,b){return new Error(""+a+" with "+b+" could not be found")}}}),define("store",["errors"],function(a){var b;return b=function(){function b(a){this.app=a,this.is_persistent()||(this.db={getItem:function(){return null},setItem:function(){return null},removeItem:function(){return null},key:function(){return null},length:function(){return 0},clear:function(){return null}})}return b.prototype.db={getItem:function(a){return window.localStorage.getItem(a)},setItem:function(a,b){return window.localStorage.setItem(a,b)},removeItem:function(a){return window.localStorage.removeItem(a)},key:function(a){return window.localStorage.key(a)},length:function(){return window.localStorage.length},clear:function(){return window.localStorage.clear()}},b.prototype.save=function(b,c,d){var e;e=this._deferred();switch(arguments.length){case 2:d=c,c=d.id;break;case 1:d=b,b=d.type,c=d.id}if(typeof d!="object")return e.reject(a.INVALID_ARGUMENTS("object is "+typeof d)),e;c||(c=this.uuid());if(!this._is_valid_key(c))return e.reject(a.INVALID_KEY({id:c})),e;if(!this._is_valid_key(b))return e.reject(a.INVALID_KEY({type:b})),e;d.created_at||(d.created_at=d.updated_at=this._now()),delete d.id,delete d.type;try{d=this.cache(b,c,d),e.resolve(d)}catch(f){e.reject(f)}return e},b.prototype.create=b.prototype.save,b.prototype.update=b.prototype.save,b.prototype.load=function(b,c){var d,e,f;e=this._deferred();if(arguments.length=typeof b=="object")f=[b.type,b.id],b=f[0],c=f[1];if(typeof b!="string"||typeof c!="string")return e.reject(a.INVALID_ARGUMENTS("type & id are required"));try{d=this.cache(b,c);if(!d)return e.reject(a.NOT_FOUND(b,c)),e;e.resolve(d)}catch(g){e.reject(g)}return e},b.prototype.get=b.prototype.load,b.prototype.loadAll=function(a){var b,c,d,e,f,g;e=this._deferred(),d=this._index();try{f=function(){var e,f,h,i;i=[];for(e=0,f=d.length;e<f;e++){c=d[e];if(a!==void 0&&c.indexOf(a)!==0||!this._is_semantic_id(c))continue;h=c.split("/"),g=h[0],b=h[1],i.push(this.cache(g,b))}return i}.call(this),e.resolve(f)}catch(h){e.reject(h)}return e},b.prototype.getAll=b.prototype.loadAll,b.prototype.destroy=function(b,c){var d,e,f;return f=this._deferred(),e=this.cache(b,c),e?(e._rev?(e._deleted=!0,this.cache(b,c,e)):(d=""+b+"/"+c,this.db.removeItem(d),delete this._cached[d],this.clear_changed(b,c)),f.resolve(e)):f.reject(a.NOT_FOUND(b,c))},b.prototype["delete"]=b.prototype.destroy,b.prototype.cache=function(a,b,c,d){var e;c==null&&(c=!1),d==null&&(d={}),e=""+a+"/"+b;if(c){this._cached[e]=$.extend(c,{type:a,id:b}),this._setObject(a,b,c);if(d.remote)return this.clear_changed(a,b),!0}else{if(this._cached[e]!=null)return this._cached[e];this._cached[e]=this._getObject(a,b)}return this.is_dirty(a,b)||this.is_marked_as_deleted(a,b)?this.mark_as_changed(a,b,this._cached[e]):this.clear_changed(a,b),this._cached[e]},b.prototype.clear_changed=function(a,b){var c;return a&&b?(c=""+a+"/"+b,delete this._dirty[c]):this._dirty={},this.app.trigger("store:dirty")},b.prototype.is_marked_as_deleted=function(a,b){return this.cache(a,b)._deleted===!0},b.prototype.mark_as_changed=function(a,b,c){var d,e,f=this;return d=""+a+"/"+b,this._dirty[d]=c,this.app.trigger("store:dirty"),e=2e3,window.clearTimeout(this._dirty_timeout),this._dirty_timeout=window.setTimeout(function(){return f.app.trigger("store:dirty:idle")},e)},b.prototype.changed_docs=function(){var a,b,c,d;c=this._dirty,d=[];for(a in c)b=c[a],d.push(b);return d},b.prototype.is_dirty=function(a,b){var c;return a==null&&(a=null),b==null&&(b=null),a?(c=""+a+"/"+b,this.cache(a,b).synced_at?this.cache(a,b).updated_at?(this.cache(a,b).synced_at instanceof Date||(this.cache(a,b).synced_at=Date.parse(this.cache(a,b).synced_at)),this.cache(a,b).updated_at instanceof Date||(this.cache(a,b).updated_at=Date.parse(this.cache(a,b).updated_at)),this.cache(a,b).synced_at.getTime()<this.cache(a,b).updated_at.getTime()):!1:!0):$.isEmptyObject(this._dirty)},b.prototype.clear=function(){var a;a=this._deferred();try{this.db.clear(),this._cached={},this.clear_changed(),a.resolve()}catch(b){a.reject(b)}return a},b.prototype.is_persistent=function(){try{if(!window.localStorage)return!1;localStorage.setItem("Storage-Test","1");if(localStorage.getItem("Storage-Test")!=="1")return!1;localStorage.removeItem("Storage-Test")}catch(a){return!1}return!0},b.prototype.uuid=function(a){var b,c,d;return a==null&&(a=7),b="0123456789abcdefghijklmnopqrstuvwxyz".split(""),d=b.length,function(){var e;e=[];for(c=0;0<=a?c<a:c>a;0<=a?c++:c--)e.push(b[0|Math.random()*d]);return e}().join("")},b.prototype._setObject=function(a,b,c){var d,e;return d=""+a+"/"+b,e=$.extend({},c),delete e.type,delete e.id,this.db.setItem(d,JSON.stringify(e))},b.prototype._getObject=function(a,b){var c,d,e;return d=""+a+"/"+b,c=this.db.getItem(d),c?(e=JSON.parse(c),e.type=a,e.id=b,e):!1},b.prototype._now=function(){return new Date},b.prototype._is_valid_key=function(a){return/^[a-z0-9]+$/.test(a)},b.prototype._is_semantic_id=function(a){return/^[a-z0-9]+\/[a-z0-9]+$/.test(a)},b.prototype._deferred=$.Deferred,b.prototype._cached={},b.prototype._dirty={},b.prototype._index=function(){var a,b,c;c=[];for(a=0,b=this.db.length();0<=b?a<b:a>b;0<=b?a++:a--)c.push(this.db.key(a));return c},b}()}),define("account",[],function(){var a;return a=function(){function a(a){this.app=a}return a.prototype.sign_up=function(a,b){var c,d,e,f,g=this;return e="org.couchdb.user",c=""+e+":"+a,f={_id:c,name:a,type:"user",roles:[],password:b},d={success:function(){return g.app.trigger("account:sign_up"),g.app.trigger("account:sign_in")}},this._request("PUT","/_users/"+encodeURIComponent(c),f,d)},a.prototype.sign_in=function(a,b){var c,d,e=this;return c={name:a,password:b},d={success:function(){return e.app.trigger("account:sign_in")}},this._request("POST","/_session",c,d)},a.prototype.login=a.prototype.sign_in,a.prototype.change_password=function(a,b){return alert("change password is not yet implementd")},a.prototype.sign_out=function(){var a,b=this;return a={success:function(){return b.app.trigger("account:sign_out")}},this._request("DELETE","/_session",null,a)},a.prototype.logout=a.prototype.sign_out,a.prototype._request=function(a,b,c,d){var e;d==null&&(d={}),e={type:a,url:""+this.app.couchDB_url+b,xhrFields:{withCredentials:!0},crossDomain:!0},e=$.extend(e,d),c&&(e.data=JSON.stringify(c));if(a==="PUT"||a==="POST")e.contentType="application/json";return $.ajax(e)},a}()});var __bind=function(a,b){return function(){return a.apply(b,arguments)}};define("remote",["errors"],function(a){var b;return b=function(){function a(a){this.app=a,this._handle_changes=__bind(this._handle_changes,this),this.push_changes=__bind(this.push_changes,this),this.app.on("store:dirty:idle",this.push_changes),this.app.on("remote:change",this._handle_changes)}return a.prototype.listen_to_changes=function(){},a.prototype.push_changes=function(a){var b,c,d,e,f;c=this.app.store.changed_docs();if(c.lenght===0)return this._deferred().resolve([]);for(e=0,f=c.length;e<f;e++)b=c[e],c=this._parse_for_remote(b);return d={type:"POST",dataType:"json",url:"/db/account/_bulk_docs",contentType:"application/json",data:JSON.stringify({docs:c}),success:this._handle_changes},$.ajax(d)},a.prototype.get_seq=function(){return 0},a.prototype.set_seq=function(){return null},a.prototype._valid_special_attributes={_id:1,_rev:1,_deleted:1},a.prototype._parse_for_remote=function(a){var b,c;c=$.extend(a);for(b in c)this._valid_special_attributes[b]&&next,/^_/.test(b)||next,delete c[b];return c},a.prototype._handle_changes=function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(this.app.store(b,{remote:!0}));return e},a.prototype._deferred=$.Deferred,a}()});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("couchapp",["events","store","account","remote"],function(a,b,c,d){var e;return e=function(a){function e(a){this.couchDB_url=a,this.couchDB_url=this.couchDB_url.replace(/\/+$/,""),this.store=new b(this),this.account=new c(this),this.remote=new d(this)}return __extends(e,a),e}(a)})