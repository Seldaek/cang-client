var __slice=Array.prototype.slice;define("events",[],function(){var a;return a=function(){function a(){}return a.prototype.bind=function(a,b){var c,d,e,f,g,h;d=a.split(" "),c=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={}),h=[];for(f=0,g=d.length;f<g;f++)e=d[f],c[e]||(c[e]=[]),h.push(c[e].push(b));return h},a.prototype.on=a.prototype.bind,a.prototype.one=function(a,b){return this.bind(a,function(){return this.unbind(a,arguments.callee),b.apply(this,arguments)})},a.prototype.trigger=function(){var a,b,c,d,e,f,g;a=1<=arguments.length?__slice.call(arguments,0):[],c=a.shift(),d=this.hasOwnProperty("_callbacks")&&((g=this._callbacks)!=null?g[c]:void 0);if(!d)return;for(e=0,f=d.length;e<f;e++)b=d[e],b.apply(this,a);return!0},a.prototype.unbind=function(a,b){var c,d,e,f,g;if(!a)return this._callbacks={},this;e=(g=this._callbacks)!=null?g[a]:void 0;if(!e)return this;if(!b)return delete this._callbacks[a],this;for(d=0,f=e.length;d<f;d++){c=e[d];if(c!==b)continue;e=e.slice(),e.splice(d,1),this._callbacks[a]=e;break}return this},a}()}),define("errors",[],function(){var a;return a={INVALID_KEY:function(a){var b;return b=a.id?"id":"type",new Error("invalid "+b+" '"+a[b]+"': numbers and lowercase letters allowed only")},INVALID_ARGUMENTS:function(a){return new Error(a)},NOT_FOUND:function(a,b){return new Error(""+a+" with "+b+" could not be found")}}});var __bind=function(a,b){return function(){return a.apply(b,arguments)}};define("store",["errors"],function(a){var b;return b=function(){function b(a){this.app=a,this.clear=__bind(this.clear,this),this.is_persistent()||(this.db={getItem:function(){return null},setItem:function(){return null},removeItem:function(){return null},key:function(){return null},length:function(){return 0},clear:function(){return null}}),this.app.on("account:sign_out",this.clear)}return b.prototype.db={getItem:function(a){return window.localStorage.getItem(a)},setItem:function(a,b){return window.localStorage.setItem(a,b)},removeItem:function(a){return window.localStorage.removeItem(a)},key:function(a){return window.localStorage.key(a)},length:function(){return window.localStorage.length},clear:function(){return window.localStorage.clear()}},b.prototype.save=function(b,c,d,e){var f;f=this._promise();switch("object"){case typeof arguments[0]:e=c,d=b,b=d.type,c=d.id;break;case typeof arguments[1]:e=d,d=c,c=d.id}if(typeof d!="object")return f.reject(a.INVALID_ARGUMENTS("object is "+typeof d)),f;c||(c=this.uuid());if(!this._is_valid_key(c))return f.reject(a.INVALID_KEY({id:c})),f;if(!this._is_valid_key(b))return f.reject(a.INVALID_KEY({type:b})),f;if(e!=null?!e.remote:!void 0)d.created_at||(d.created_at=d.updated_at=this._now());delete d.id,delete d.type;try{d=this.cache(b,c,d,e),f.resolve(d)}catch(g){f.reject(g)}return f},b.prototype.create=b.prototype.save,b.prototype.update=b.prototype.save,b.prototype.load=function(b,c){var d,e,f;e=this._promise();if(arguments.length=typeof b=="object")f=[b.type,b.id],b=f[0],c=f[1];if(typeof b!="string"||typeof c!="string")return e.reject(a.INVALID_ARGUMENTS("type & id are required"));try{d=this.cache(b,c);if(!d)return e.reject(a.NOT_FOUND(b,c)),e;e.resolve(d)}catch(g){e.reject(g)}return e},b.prototype.get=b.prototype.load,b.prototype.loadAll=function(a){var b,c,d,e,f,g;e=this._promise(),d=this._index();try{f=function(){var e,f,h,i;i=[];for(e=0,f=d.length;e<f;e++){c=d[e];if(a!==void 0&&c.indexOf(a)!==0||!this._is_semantic_id(c))continue;h=c.split("/"),g=h[0],b=h[1],i.push(this.cache(g,b))}return i}.call(this),e.resolve(f)}catch(h){e.reject(h)}return e},b.prototype.getAll=b.prototype.loadAll,b.prototype.destroy=function(b,c){var d,e,f;return f=this._promise(),e=this.cache(b,c),e?(e._rev?(e._deleted=!0,this.cache(b,c,e)):(d=""+b+"/"+c,this.db.removeItem(d),delete this._cached[d],this.clear_changed(b,c)),f.resolve(e)):f.reject(a.NOT_FOUND(b,c))},b.prototype["delete"]=b.prototype.destroy,b.prototype.cache=function(a,b,c,d){var e;c==null&&(c=!1),d==null&&(d={}),e=""+a+"/"+b;if(c){this._cached[e]=$.extend(c,{type:a,id:b}),this._setObject(a,b,c);if(d.remote)return this.clear_changed(a,b),!0}else{if(this._cached[e]!=null)return this._cached[e];this._cached[e]=this._getObject(a,b)}return this.is_dirty(a,b)||this.is_marked_as_deleted(a,b)?this.mark_as_changed(a,b,this._cached[e]):this.clear_changed(a,b),this._cached[e]},b.prototype.clear_changed=function(a,b){var c;return a&&b?(c=""+a+"/"+b,delete this._dirty[c]):this._dirty={},this.app.trigger("store:dirty")},b.prototype.is_marked_as_deleted=function(a,b){return this.cache(a,b)._deleted===!0},b.prototype.mark_as_changed=function(a,b,c){var d,e,f=this;return d=""+a+"/"+b,this._dirty[d]=c,this.app.trigger("store:dirty"),e=2e3,window.clearTimeout(this._dirty_timeout),this._dirty_timeout=window.setTimeout(function(){return f.app.trigger("store:dirty:idle")},e)},b.prototype.changed_docs=function(){var a,b,c,d;c=this._dirty,d=[];for(a in c)b=c[a],d.push(b);return d},b.prototype.is_dirty=function(a,b){var c;return a==null&&(a=null),b==null&&(b=null),a?(c=""+a+"/"+b,this.cache(a,b).synced_at?this.cache(a,b).updated_at?(this.cache(a,b).synced_at instanceof Date||(this.cache(a,b).synced_at=Date.parse(this.cache(a,b).synced_at)),this.cache(a,b).updated_at instanceof Date||(this.cache(a,b).updated_at=Date.parse(this.cache(a,b).updated_at)),this.cache(a,b).synced_at.getTime()<this.cache(a,b).updated_at.getTime()):!1:!0):$.isEmptyObject(this._dirty)},b.prototype.clear=function(){var a;a=this._promise();try{this.db.clear(),this._cached={},this.clear_changed(),a.resolve()}catch(b){a.reject(b)}return a},b.prototype.is_persistent=function(){try{if(!window.localStorage)return!1;localStorage.setItem("Storage-Test","1");if(localStorage.getItem("Storage-Test")!=="1")return!1;localStorage.removeItem("Storage-Test")}catch(a){return!1}return!0},b.prototype.uuid=function(a){var b,c,d;return a==null&&(a=7),b="0123456789abcdefghijklmnopqrstuvwxyz".split(""),d=b.length,function(){var e;e=[];for(c=0;0<=a?c<a:c>a;0<=a?c++:c--)e.push(b[0|Math.random()*d]);return e}().join("")},b.prototype._setObject=function(a,b,c){var d,e;return d=""+a+"/"+b,e=$.extend({},c),delete e.type,delete e.id,this.db.setItem(d,JSON.stringify(e))},b.prototype._getObject=function(a,b){var c,d,e;return d=""+a+"/"+b,c=this.db.getItem(d),c?(e=JSON.parse(c),e.type=a,e.id=b,e):!1},b.prototype._now=function(){return new Date},b.prototype._is_valid_key=function(a){return/^[a-z0-9]+$/.test(a)},b.prototype._is_semantic_id=function(a){return/^[a-z0-9]+\/[a-z0-9]+$/.test(a)},b.prototype._promise=$.Deferred,b.prototype._cached={},b.prototype._dirty={},b.prototype._index=function(){var a,b,c;c=[];for(a=0,b=this.db.length();0<=b?a<b:a>b;0<=b?a++:a--)c.push(this.db.key(a));return c},b}()});var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__slice=Array.prototype.slice;define("account",[],function(){var a;return a=function(){function a(a){this.app=a,this._handle_sign_out=__bind(this._handle_sign_out,this),this._handle_sign_in=__bind(this._handle_sign_in,this),this.email=this.app.store.db.getItem("_couch.account.email"),this.authenticate(),this.app.on("account:sign_in",this._handle_sign_in),this.app.on("account:sign_out",this._handle_sign_out)}return a.prototype.email=void 0,a.prototype.authenticate=function(){var a,b=this;return a=this.app.promise(),this.email?this._authenticated===!0?a.resolve(this.email):this._authenticated===!1?a.reject():(this.app.request("GET","/_session",{success:function(c){return c.userCtx.name?(b._authenticated=!0,b.email=c.userCtx.name,a.resolve(b.email)):(b._authenticated=!1,b.app.trigger("account:error:not_authenticated"),a.reject())},error:a.reject}),a):a.reject()},a.prototype.sign_up=function(a,b){var c,d,e=this;return d="org.couchdb.user",c=""+d+":"+a,this.app.request("PUT","/_users/"+encodeURIComponent(c),{data:{_id:c,name:a,type:"user",roles:[],password:b},success:function(){var a,b;return(a=e.app).trigger.apply(a,["account:sign_up"].concat(__slice.call(arguments))),(b=e.app).trigger.apply(b,["account:sign_in"].concat(__slice.call(arguments)))}})},a.prototype.sign_in=function(a,b){var c=this;return this.app.request("POST","/_session",{data:{name:a,password:b},success:function(){var a;return(a=c.app).trigger.apply(a,["account:sign_in"].concat(__slice.call(arguments)))}})},a.prototype.login=a.prototype.sign_in,a.prototype.change_password=function(a,b){return alert("change password is not yet implementd")},a.prototype.sign_out=function(){var a=this;return this.app.request("DELETE","/_session",{success:function(){var b;return(b=a.app).trigger.apply(b,["account:sign_out"].concat(__slice.call(arguments)))}})},a.prototype.logout=a.prototype.sign_out,a.prototype._handle_sign_in=function(a){return this.email=a.name,this.app.store.db.setItem("_couch.account.email",this.email),this._authenticated=!0},a.prototype._handle_sign_out=function(a){return delete this.email,this.app.store.db.removeItem("_couch.account.email"),this._authenticated=!1},a}()});var __bind=function(a,b){return function(){return a.apply(b,arguments)}};define("remote",["errors"],function(a){var b;return b=function(){function a(a){this.app=a,this._handle_changes=__bind(this._handle_changes,this),this._changes_error=__bind(this._changes_error,this),this._changes_success=__bind(this._changes_success,this),this._restart_changes_request=__bind(this._restart_changes_request,this),this.push_changes=__bind(this.push_changes,this),this.pull_changes=__bind(this.pull_changes,this),this.disconnect=__bind(this.disconnect,this),this.connect=__bind(this.connect,this),this.app.on("store:dirty:idle",this.push_changes),this.connect(),this.app.on("account:sign_in",this.connect),this.app.on("account:sign_out",this.disconnect)}return a.prototype.connect=function(){if(this._connected)return;return this.app.account.authenticate().done(this.pull_changes)},a.prototype.disconnect=function(){return this._connected=!1,this._changes_request&&this._changes_request.abort(),this.app.store.db.removeItem("_couch.remote.seq")},a.prototype.pull_changes=function(){return this._connected=!0,this._changes_request=this.app.request("GET",this._changes_path(),{success:this._changes_success,error:this._changes_error}),window.clearTimeout(this._changes_request_timeout),this._changes_request_timeout=window.setTimeout(this._restart_changes_request,59e3)},a.prototype.push_changes=function(a){return console.log("@app.store.changed_docs()",this.app.store.changed_docs()),$.ajax({type:"POST",url:"http://cors.io/funtime.g3th.net:5984/cang/_bulk_docs",data:'{"docs": []}',contentType:"application/json"})},a.prototype.get_seq=function(){return this._seq||(this._seq=this.app.store.db.getItem("_couch.remote.seq")||0)},a.prototype.set_seq=function(a){return this._seq=this.app.store.db.setItem("_couch.remote.seq",a)},a.prototype._changes_path=function(){var a,b;return b=this.get_seq(),a="joe_example_com","/"+encodeURIComponent(this.app.account.email)+"/_changes?include_docs=true&heartbeat=10000&feed=longpoll&since="+b},a.prototype._restart_changes_request=function(){var a;return(a=this._changes_request)!=null?a.abort():void 0},a.prototype._changes_success=function(a){if(!this._connected)return;return this._handle_changes(a),this.pull_changes()},a.prototype._changes_error=function(a,b,c){if(!this._connected)return;switch(a.status){case 403:return this.trigger("error:unauthorized"),this.stop();case 404:return window.setTimeout(this.pull_changes,this._changes_timeout(3e3));case 500:return this.trigger("error:server"),this.stop();default:return a.statusText==="abort"?this.pull_changes():(window.setTimeout(this.pull_changes,this._changes_timeout()),this._double_changes_timeout())}},a.prototype._valid_special_attributes={_id:1,_rev:1,_deleted:1},a.prototype._parse_for_remote=function(a){var b,c;c=$.extend({},a);for(b in c){if(this._valid_special_attributes[b])continue;if(!/^_/.test(b))continue;delete c[b]}return c},a.prototype._parse_from_remote=function(a){var b;return b=a._id,delete a._id,a.id=b.split(/\//).pop(),a},a.prototype._handle_changes=function(a){var b,c,d,e,f;this.set_seq(a.last_seq),e=a.results,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(this.app.store.save(this._parse_from_remote(b.doc),{remote:!0}));return f},a.prototype._changes_timeout_default=100,a.prototype._changes_timeout_current=100,a.prototype._changes_timeout=function(a){return a?this._changes_timeout_current=a:this._changes_timeout_current},a.prototype._reset_changes_timeout=function(){return this._changes_timeout_current=this._changes_timeout_default},a.prototype._double_changes_timeout=function(){return this._changes_timeout_current=this._changes_timeout_current*2},a.prototype._promise=$.Deferred,a}()});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("couchapp",["events","store","account","remote"],function(a,b,c,d){var e;return e=function(a){function e(a){this.couchDB_url=a,this.couchDB_url=this.couchDB_url.replace(/\/+$/,""),this.store=new b(this),this.account=new c(this),this.remote=new d(this)}return __extends(e,a),e.prototype.request=function(a,b,c){var d;return c==null&&(c={}),d={type:a,url:""+this.couchDB_url+b,xhrFields:{withCredentials:!0},crossDomain:!0,dataType:"json"},$.ajax($.extend(d,c))},e.prototype.promise=$.Deferred,e}(a)})